@{
    ViewBag.Title = "EditSKU";
    Layout = "~/Views/Shared/_Layout.Edit.cshtml";
}

@using Model;
@model SKUInfo



@*@using (@Ajax.BeginForm("EditSKU", "Manage",FormMethod.Post ,new { @class = "form-inline", id = "mainContent" }))
    {*@

@using (Ajax.BeginForm("EditSKU", "Manage", new AjaxOptions { HttpMethod = FormMethod.Post.ToString(), OnSuccess = "submitSuccess" }, new { id = "mainContent", enctype = "multipart/form-data" }))
{

    @*@using (Html.BeginForm("EditSKU", "Manage", FormMethod.Post, new { encType = "multipart/form-data" }))
{*@
    //enctype = "multipart/form-data"

    <div class="container">


        @Html.TextBoxFor(c => c.Id, new { @class = "hidden" })

        @Html.TextBoxFor(c => c.imgUrl, new {@id="imgUrl", @class="hidden"})


        <div class="form-group ">
            <label class="control-label"><span style="color:red">*</span>SKU</label>

            @*<input type="text" id="portname" name="portname" class="form-control input-sm" />*@
            @Html.TextBoxFor(c => c.sku, new { @id = "sku", @class = "form-control input-sm" })
        </div>



        <div class="form-group">
            <label class="control-label">商品名称</label>

            @*<input type="text" id="chsportname" name="chsportname" class="form-control" />*@
            @Html.TextBoxFor(c => c.chsName, new { @class = "form-control input-sm" })

        </div>




        <div class="form-group ">
            
            <div>
                @*<input type="text" id="country" name="country" class="form-control" />*@
                @*@Html.TextBoxFor(c => c.imgUrl, new {@id="country", @class = "form-control input-sm" })*@

                @*<input type="file" name="imgUrl" id="imgUrl" multiple class="file-loading" />*@
                @*<input id="fileUpload" type="file" class="file" multiple="multiple">*@

                @*@Html.LabelFor(c=>c.attach, new { @class = "control-label" })*@

                @*@Html.TextBoxFor(model => model.attach, new { type = "file", multiple = "multiple", accept = "application/msword,application/pdf,application/vnd.openxmlformats-officedocument.wordprocessingml.document" })
                    @Html.ValidationMessageFor(m => m.attach, "", new { @class = "text-danger" })*@


                <div class="file-loading">
                @*<input id="input-20" type="file">*@
                @Html.TextBoxFor(c => c.Files, new { @id="input-20", type = "file", multiple = "multiple",accept="image/*" })


                </div>

            </div>
        </div>




        @*<div class="form-group" id="divUser">
                <label class="control-label"><span style="color:red">*</span> 维护人</label>
                <div>
                    @Html.TextBoxFor(c => c.Cdt, new { @class = "form-control input-sm", @readonly = "readonly" })
                </div>
            </div>*@





    </div>





}



@section scripts{

    <script type="text/javascript">

    //var url = rootUrl + "attachment/upload";
    //$("#attach").fileinput({
    //    theme: "explorer", //主题
    //    language: 'zh',
    //    uploadUrl: url,// 上传请求路径
    //    allowedFileExtensions: ["jpg", "gif", "png"],//允许上传的文件后缀
    //    showUpload: false,//是否显示上传按钮
    //    showCaption: false,//是否显示容器
    //    dropZoneEnabled: false,//是否显示拖拽区域
    //    removeFromPreviewOnError: true,//是否移除校验文件失败的文件
    //    layoutTemplates: {
    //        actionUpload: '',   //取消上传按钮
    //        actionZoom: ''      //取消放大镜按钮
    //    },
    //    showPreview: true,      //显示预览
    //    minFileCount: 1,   //最低文件数量
    //    //maxFileCount: 3,   //最多文件数量
    //    maxFileSize: 1024 * 2,  //允许文件上传大小
    //    overwriteInitial: false,
    //    previewFileIcon: '<i class="fa fa-file"></i>',
    //    initialPreviewAsData: true, // defaults markup
    //    preferIconicPreview: true, // 是否优先显示图标  false 即优先显示图片
    //    previewFileIconSettings: { // configure your icon file extensions
    //        'doc': '<i class="fa fa-file-word-o text-primary"></i>',
    //        'docx': '<i class="fa fa-file-word-o text-primary"></i>',
    //        'xls': '<i class="fa fa-file-excel-o text-success"></i>',
    //        'xlsx': '<i class="fa fa-file-excel-o text-success"></i>',
    //        'ppt': '<i class="fa fa-file-powerpoint-o text-danger"></i>',
    //        'pdf': '<i class="fa fa-file-pdf-o text-danger"></i>',
    //        'zip': '<i class="fa fa-file-archive-o text-muted"></i>',
    //        'htm': '<i class="fa fa-file-code-o text-info"></i>',
    //        'txt': '<i class="fa fa-file-text-o text-info"></i>',
    //        'mov': '<i class="fa fa-file-movie-o text-warning"></i>',
    //        'mp3': '<i class="fa fa-file-audio-o text-warning"></i>',
    //        'jpg': '<i class="fa fa-file-photo-o text-danger"></i>',
    //        'gif': '<i class="fa fa-file-photo-o text-muted"></i>',
    //        'png': '<i class="fa fa-file-photo-o text-primary"></i>'
    //    }
    //});

    $('#mainContent').bootstrapValidator({
        message: '请检查输入值',
        feedbackIcons: {
            valid: 'glyphicon glyphicon-ok',
            invalid: 'glyphicon glyphicon-remove',
            validating: 'glyphicon glyphicon-refresh'
        },
        fields: {

            sku: {
                validators: {
                    notEmpty: {
                        message: 'SKU不能为空'
                    }
                }
            },
            chsName: {
                validators: {
                    notEmpty: {
                        message: '商品名称不能为空'
                    }
                }
            }


        }

    }).on('success.form.bv', function (e) {
        // Prevent form submission 修复bootstrap validator重复向服务端提交bug
        e.preventDefault();
        //alert('validate success');
    });

    //function bsvlidtorFormatter() {
    //    $('#mainContent').bootstrapValidator({
    //        message: 'This value is not valid',
    //        fields: {

    //            teamtitle: {
    //                validators: {
    //                    notEmpty: {
    //                        message: 'The field is required'
    //                    }
    //                }
    //            },
    //            mfg: {
    //                validators: {
    //                    notEmpty: {
    //                        message: 'The field is required'
    //                    }
    //                }
    //            },
    //            qlty: {
    //                validators: {
    //                    notEmpty: {
    //                        message: 'The field is required'
    //                    }
    //                }
    //            },
    //            pcl: {
    //                validators: {
    //                    notEmpty: {
    //                        message: 'The field is required'
    //                    }
    //                }
    //            },
    //            sales: {
    //                validators: {
    //                    notEmpty: {
    //                        message: 'The field is required'
    //                    }
    //                }
    //            },
    //            dcu: {
    //                validators: {
    //                    notEmpty: {
    //                        message: 'The field is required'
    //                    }
    //                }
    //            }, splRm: {
    //                validators: {
    //                    notEmpty: {
    //                        message: 'The field is required'
    //                    }
    //                }
    //            },
    //            PEmgr: {
    //                validators: {
    //                    notEmpty: {
    //                        message: 'The field is required'
    //                    }
    //                }
    //            }
    //        }

    //    }).on('success.form.bv', function (e) {
    //        // Prevent form submission 修复bootstrap validator重复向服务端提交bug
    //        e.preventDefault();
    //        //alert('validate success');
    //    });
    //}

    function execute_validator() {
        var bv = $("#mainContent").data('bootstrapValidator').validate();
        return bv.isValid();
    }
    function form_submit() {
        if (execute_validator()) {

            if ($("#imgUrl").val() == "") {

                layer.msg("请上传图片", { time: 500, icon: 2 });
                return false;
            }

            $("#mainContent").submit();


            return false;
        } else return false;

        //if ($("#portname").val() == "") {

        //   // alert("test")
        //    layer.msg("港口代码不能为空", { time: 1000, icon: 2 });
        //    return false;
        //}

        //if ($("#country").val() == "") {


        //    layer.msg("国家不能为空", { time: 1000, icon: 2 });
        //    return false;
        //}



        //$("#mainContent").submit();
        //   return true;
    }



    // form submit success callback
    function submitSuccess(res) {
        if (res.state) {
            // layer.close(index);
            //// alert("submitsuccess")


            var index = parent.layer.getFrameIndex(window.name);
            parent.layer.close(index);
            window.parent.location.reload(); //刷新父页面
            layer.msg(res.msg, { time: 1000, icon: 1 });

        } else {

            layer.msg(res.msg, { time: 1000, icon: 2 });

        }
        window.close();
    }

    //初始化fileinput
    //var FileInput = function () {
    //    var oFile = new Object();

    //    //初始化fileinput控件（第一次初始化）
    //    oFile.Init = function (ctrlName, uploadUrl) {
    //        var control = $('#' + ctrlName);

    //        //初始化上传控件的样式
    //        control.fileinput({
    //            language: 'zh', //设置语言
    //            uploadUrl: uploadUrl, //上传的地址
    //            allowedFileExtensions: ['jpg', 'gif', 'png'],//接收的文件后缀
    //            showUpload: true, //是否显示上传按钮
    //            showCaption: false,//是否显示标题
    //            browseClass: "btn btn-primary", //按钮样式
    //            //dropZoneEnabled: false,//是否显示拖拽区域
    //            //minImageWidth: 50, //图片的最小宽度
    //            //minImageHeight: 50,//图片的最小高度
    //            //maxImageWidth: 1000,//图片的最大宽度
    //            //maxImageHeight: 1000,//图片的最大高度
    //            //maxFileSize: 0,//单位为kb，如果为0表示不限制文件大小
    //            //minFileCount: 0,
    //            maxFileCount: 10, //表示允许同时上传的最大文件个数
    //            enctype: 'multipart/form-data',
    //            validateInitialCount: true,
    //            previewFileIcon: "<i class='glyphicon glyphicon-king'></i>",
    //            msgFilesTooMany: "选择上传的文件数量({n}) 超过允许的最大数值{m}！",
    //        });

    //        //导入文件上传完成之后的事件
    //        $("#imgUrl").on("fileuploaded", function (event, data, previewId, index) {
    //            //$("#myModal").modal("hide");
    //            var data = data.response.lstOrderImport;
    //            if (data == undefined) {
    //                toastr.error('文件格式类型不正确');
    //                return;
    //            }
    //            //1.初始化表格
    //            var oTable = new TableInit();
    //            oTable.Init(data);
    //            $("#div_startimport").show();
    //        });
    //    }
    //    return oFile;
    //};


    function BSFileUpload(loadctrId, ChgId, lstTbId) {
        //var loadId = '#' + loadctrId;
        $('#' + loadctrId).fileinput('refresh', {
            //theme: "explorer-fa", //主题
            uploadUrl: '../Service/Upload', //上传的地址
            uploadExtraData: { "ChgId": ChgId },
            //allowedFileExtensions: ['xls', 'xlsx'],//接收的文件后缀
            uploadAsync: true, //默认异步上传
            showUpload: true, //是否显示上传按钮
            showRemove: false, //显示移除按钮
            showPreview: true, //是否显示预览
            showCaption: true,//是否显示标题
            browseClass: "btn btn-primary btn-sm", //按钮样式
            autoReplace: true,
            showCancel: false,
            dropZoneEnabled: false,//是否显示拖拽区域
            removeFromPreviewOnError: false,//是否移除校验文件失败的文件
            maxFileCount: 5, //表示允许同时上传的最大文件个数
            enctype: 'multipart/form-data',
            validateInitialCount: true,
            layoutTemplates: {
                actionUpload: '',   //取消上传按钮
                actionZoom: ''      //取消放大镜按钮
            },
            maxFileSize: 1024 * 10,  //允许文件上传大小
            overwriteInitial: false,
            previewFileIcon: '<i class="fa fa-file"></i>',
            initialPreviewAsData: true, // defaults markup
            preferIconicPreview: true, // 是否优先显示图标  false 即优先显示图片
            previewFileIconSettings: { // configure your icon file extensions
                'doc': '<i class="fa fa-file-word-o text-primary"></i>',
                'docx': '<i class="fa fa-file-word-o text-primary"></i>',
                'xls': '<i class="fa fa-file-excel-o text-success"></i>',
                'xlsx': '<i class="fa fa-file-excel-o text-success"></i>',
                'ppt': '<i class="fa fa-file-powerpoint-o text-danger"></i>',
                'pdf': '<i class="fa fa-file-pdf-o text-danger"></i>',
                'zip': '<i class="fa fa-file-archive-o text-muted"></i>',
                'htm': '<i class="fa fa-file-code-o text-info"></i>',
                'txt': '<i class="fa fa-file-text-o text-info"></i>',
                'mov': '<i class="fa fa-file-movie-o text-warning"></i>',
                'mp3': '<i class="fa fa-file-audio-o text-warning"></i>',
                'jpg': '<i class="fa fa-file-photo-o text-danger"></i>',
                'gif': '<i class="fa fa-file-photo-o text-muted"></i>',
                'png': '<i class="fa fa-file-photo-o text-primary"></i>'
            }
        }).on("fileuploaded", function (event, data, previewId, index) {
            $(this).fileinput("clear").fileinput("enable");   //reSet
            if (data.response.state) {
                ListFiles2Table(lstTbId, ChgId);
            } else {
                layer.msg(data.response.msg, { time: 2000, icon: 2 });
            }

        });


    }

    $(function () {

        @*path = ['../UploadFiles/ @ViewBag.img'];

            alert(path);*@
        
        if ('@ViewBag.id' == "") {

          
            $('#sku').removeAttr("readonly");//去除input元素的readonly属性

        } else {

            $('#sku').attr("readonly", "readonly")//将input元素设置为readonly
        }


        if ('@ViewBag.img' == "") {

            $("#input-20").fileinput({
                browseClass: "btn btn-primary btn-block",
                showCaption: false,
                showRemove: false,
                showUpload: true,
                uploadUrl: '../Manage/UploadSKUPic',
                enctype: 'multipart/form-data',
                //initialPreviewFileType: 'image',
                //initialPreview: path,
                //initialPreviewAsData: true

                //uploadExtraData:function (previewId, index) {
                //    //向后台传递id作为额外参数，是后台可以根据id修改对应的图片地址。
                //    var obj = {};
                //    obj.id = id;
                //    return obj;
                //}
            }).on("fileuploaded", function (event, data, previewId, index) {
                // $(this).fileinput("clear").fileinput("enable");   //reSet
                if (data.response.state) {
                    //  ListFiles2Table(lstTbId, ChgId);
                    $("#imgUrl").val(data.response.imgUrl);
                    // alert($("#imgUrl").val());
                } else {
                    layer.msg(data.response.msg, { time: 2000, icon: 2 });
                }

            }).on('filesuccessremove', function (event, key) {
                $("#imgUrl").val("");
            }).on('filecleared', function (event) {
                $("#imgUrl").val("");
            });

        } else {

            //var url1 = 'C:/Source/web/projects/code/quyou/quyou/quyou/UploadFiles/2d7d60ec-8b31-4631-8695-692ff781f72d_download.jpg';
            $("#input-20").fileinput({
                browseClass: "btn btn-primary btn-block",
                showCaption: false,
                showRemove: false,
                showUpload: true,
                uploadUrl: '../Manage/UploadSKUPic',
                enctype: 'multipart/form-data',
                //initialPreview : data.initialPreview,
                initialPreviewAsData: true, // allows you to set a raw markup
                initialPreviewFileType: 'image', // image is the default and can be overridden in config below
                //initialPreviewDownloadUrl: GLOBAL.URL+'project/downFile.do?image={key}',
                // initialPreview: ["<img src='http://localhost:11739/UploadFiles/7abb3e27-96d3-47fb-aa3a-1340f0ea356b_download.jpg' />"]
                //initialPreview: ['<img  src="http://localhost:11739/UploadFiles/7abb3e27-96d3-47fb-aa3a-1340f0ea356b_download.jpg">']

                initialPreview: [function () {
                    if ('@ViewBag.img' != "")
                    { return 'http://localhost:11739/UploadFiles/@ViewBag.img'; } else { }
                }]

                //initialPreView: ["<img src='http://localhost:11739/UploadFiles/@ViewBag.img'>"],
                //defaultPreviewContent: '<img src="http://localhost:11739/UploadFiles/@ViewBag.img">'


                //initialPreviewConfig: [
                //{ downloadUrl: url1, key: 1 }]

                //uploadExtraData:function (previewId, index) {
                //    //向后台传递id作为额外参数，是后台可以根据id修改对应的图片地址。
                //    var obj = {};
                //    obj.id = id;
                //    return obj;
                //}
            }).on("fileuploaded", function (event, data, previewId, index) {
                // $(this).fileinput("clear").fileinput("enable");   //reSet
                if (data.response.state) {
                    //  ListFiles2Table(lstTbId, ChgId);
                    $("#imgUrl").val(data.response.imgUrl);
                    // alert($("#imgUrl").val());
                } else {
                    layer.msg(data.response.msg, { time: 2000, icon: 2 });
                }

            }).on('filesuccessremove', function (event, key) {
                $("#imgUrl").val("");
            }).on('filecleared', function (event) {
                $("#imgUrl").val("");
            });


        }










        //var oFileInput = new FileInput();
        //oFileInput.Init("imgUrl", "");

        // BSFileUpload("fileUpload", $('#ChgId').val(), "tbDocs");


        @*$("#id").val('@ViewBag.id');

            if ('@ViewBag.act' != null && '@ViewBag.act' == 'Edit') {

                $("#divUser").attr("style", "display:block;")

                $.get('@Url.Action("ReadPort", "Manage")', { id: $('#id').val() }, function (data) {
                    //$.each(data, function () { bind_AffectedPNs(this); });
                    //$(data).each(function (MbrId) { console.log(MbrId); });


                    //for (var i = 0; i < data.length; i++) {

                    //     alert(data[i])

                    //}


                    $("#portname").attr("value", data[0].portname);
                    $("#chsportname").attr("value", data[0].chsportname);
                    $("#country").attr("value", data[0].country);
                    $("#chscountry").attr("value", data[0].chscountry);
                    $("#username").attr("value", data[0].username);


                });



            } else {
                $("#divUser").attr("style", "display:none;")


            }*@


    });


    function peopleSearch_multiCtr(crnId) {
        $(crnId).select2({
            ajax: {
                cache: false,
                dataType: "json",
                type: "GET",
                url: '../Service/ListUsers2',
                delay: 250,
                success: function (data) {
                },
                data: function (params) {
                    return {
                        query: params.term   // 查询的关键字
                    };
                },
                processResults: function (data) {
                    return {
                        results: data
                    };
                }
            },
            placeholder: 'Select a person...',   //需要select控件使用默认默认,或者placeholder无效
            allowClear: true,
            theme: 'classic',
            minimumInputLength: 2,
            //minimumResultsForSearch: 5, // at least 20 results must be displayed   myteammodal
            maximumSelectionLength: 3, //最多能够选择的个数
            tags: false,//允许手动添加
            templateResult: function (obj) { return obj.text; },    // 显示查询结果
            templateSelection: function (user) { return user.text; },    // 显示选中的对象
            escapeMarkup: function (markup) { return markup; }
        });
    }

    </script>
}